<div class="chatbot-popup" id="chatbot-popup" style="display:block;">
  <div class="chat-header">
    <span>Proof A - Message Window</span>
    <button id="close-btn" (click)="closePopup()">&times;</button>
  </div>
  <div class="chat-box-container">
    <div class="chat-box" id="chat-box">
        @for (message of messages; track message.contentSid) {
          <div class="message-container {{(message.author === currentUser || message.author?.includes('Team') || ( message.author?.includes('Support') && currentWindow == 'note' ))  ? 'message-container-right' : ''}}">

            @if (currentWindow==='chat')
            {
              <ng-container>
                @if (
                  !((message.body?.includes('__##__') || messageMediaType(message) == 'note') && currentUser.includes('User') )
                  )
                {
                  <div class="avatar-img-container"><img
                    src="https://i2.wp.com/woodfibreinsulation.co.uk/wp-content/uploads/2017/04/blank-profile-picture-973460-1-1-1080x1080.png"
                    class="chat-avatar-img">
                    <div class="
                      {{message.author === currentUser ? 'message-container-right' : 'avatar-online-dot'}}
                      {{ message.author && participantsStatus.get(message.author) ? 'dot-green' : 'dot-yellow'}}
                    ">
                    </div> <!-- Add this line for the green dot -->
                  </div>
                  <div class="
                          {{message.author === currentUser ? 'message-position-right' : 'message-position-left'}}
                          {{message.author === currentUser ? 'message-color-yellow' : 'message-color-green'}}
                          {{message.body?.includes('__##__') && message.author?.includes('Team') ? 'message-position-right message-color-grey' : ''}}
                        ">
                    @if (message.type === 'media')
                    {
                      <img [src]="getMessageMedia(message.sid)" alt="Icon" class="icon-img document-msg">
                    }@else{
                      <span>{{ message?.body?.split('__##__')?.[1] || message?.body}}</span>
                    }
                    <div class="message-sender">
                      {{message.author == currentUser ? 'You' : message.author}}</div>
                    <div class="message-time">{{message.dateCreated | date:'yyyy:mm:dd hh:mm aa'}}</div>
                  </div>
                }
              </ng-container>
            }
            @else if (currentWindow==='note') {
              <ng-container>
                @if (
                  (!message.author?.includes('User') && message.body?.includes('__##__') || messageMediaType(message) == 'note')
                  )
                {
                  <div class="avatar-img-container"><img
                    src="https://i2.wp.com/woodfibreinsulation.co.uk/wp-content/uploads/2017/04/blank-profile-picture-973460-1-1-1080x1080.png"
                    class="chat-avatar-img">
                    <div class="
                      {{message.author === currentUser ? 'message-container-right' : 'avatar-online-dot'}}
                      {{ message.author && participantsStatus.get(message.author) ? 'dot-green' : 'dot-yellow'}}
                    ">
                    </div> <!-- Add this line for the green dot -->
                  </div>
                  <div class="
                          {{'message-position-right'}}
                          {{message.author?.includes('Team') ? 'message-color-grey':'message-color-yellow'}}
                        ">
                    @if (message.type === 'media')
                    {
                      <img [src]="getMessageMedia(message.sid)" alt="Icon" class="icon-img document-msg">
                    }@else{
                      <span>{{ message?.body?.split('__##__')?.[1] || message?.body}}</span>
                    }
                    <div class="message-sender">
                      {{message.author == currentUser ? 'You' : message.author}}</div>
                    <div class="message-time">{{message.dateCreated | date:'yyyy:mm:dd hh:mm aa'}}</div>
                  </div>
                }
              </ng-container>
            }
          </div>
        } @empty {
        <li>There are no items.</li>
        }




<!--      <div class="user-message user2-message-bg">sss<div class="message-sender">Akash</div><div class="message-time">29-03-2024 10:23 AM</div></div></div>-->

  </div>
  <div class="chat-input">
    <div id="btn_toggleActive">
      @if (currentUser.includes('Support') || currentUser.includes('User')){
        <button [class.button-active]="currentWindow == 'chat'" type="button" id="chat_tab_btn" class="chat-button check-toggleActive-btn" (click)="clickChat()">Chat</button>
      }
      @if (currentUser.includes('Team') || currentUser.includes('Support')){
        <button [class.button-active]="currentWindow == 'note'" type="button" id="note_tab_btn" class="chat-button check-toggleActive-btn" (click)="clickNote()">Notes</button>
      }



<!--      <input  id='' type="text" [(ngModel)]="messageInput" class="text-center w-full p-1 focus:outline-none " placeholder="Please enter your message..." required/>-->
       <textarea  id="user-input" (keyup)="checkForKeyPress($event)" [(ngModel)]="messageInput" rows="4" cols="50" placeholder="Please enter your message..."></textarea>
      @if (isAtKeyPressed) {
        <div id="suggestionPopover" class="popover popover-scrollbar" style="">
          @for (participant of filteredParticipants; track participant) {
            @if(participant !== currentUser ){
              <li (click)="onDropDownParticipantClick(participant)" >
                <img class="rounded-image" src="https://i2.wp.com/woodfibreinsulation.co.uk/wp-content/uploads/2017/04/blank-profile-picture-973460-1-1-1080x1080.png" alt="user"> <div class="avatar-online-dot-atr {{participantsStatus.get(participant) ? 'dot-green' : 'dot-yellow'}}"></div>
                {{participant}}
              </li>
            }
          }
        </div>
      }

    </div>
    <div class="revision_request">
      <input type="checkbox" id="vehicle1" name="vehicle1" value="Bike">
      <label for="vehicle1">Revision Request</label><br>
      <div>
        <div style="text-align: right;" >
          <button id="send-btn" (click)="sendMessage()">Send</button>
        </div>
      </div>
      <div class="col-md-4">
        <div class="upload-btn-wrapper cursor-pointer">
          <button type="submit" class="btn btn-primary animated" >
            <img src="assets/Vector.svg" alt="Icon" class="icon-img">
          </button>
          <input type="file" name="myfile" (change)="uploadFile($event)" />
        </div>
        @if (selectedFile){
          <span class="ml-2">{{ selectedFile }}</span>
        }
<!--        <button class="btn btn-primary"> hello</button>-->
      </div>
    </div>
  </div>
</div>
</div>
